<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Future value · EnergyModelsRecedingHorizon</title><meta name="title" content="Future value · EnergyModelsRecedingHorizon"/><meta property="og:title" content="Future value · EnergyModelsRecedingHorizon"/><meta property="twitter:title" content="Future value · EnergyModelsRecedingHorizon"/><meta name="description" content="Documentation for EnergyModelsRecedingHorizon."/><meta property="og:description" content="Documentation for EnergyModelsRecedingHorizon."/><meta property="twitter:description" content="Documentation for EnergyModelsRecedingHorizon."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">EnergyModelsRecedingHorizon</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../quick-start/">Quick Start</a></li><li><a class="tocitem" href="../philosophy/">Philosophy</a></li><li class="is-active"><a class="tocitem" href>Future value</a><ul class="internal"><li><a class="tocitem" href="#man-fv-sev"><span>Storage end values</span></a></li><li><a class="tocitem" href="#man-fv-tev"><span>Type end values</span></a></li></ul></li><li><a class="tocitem" href="../simple-example/">Example</a></li><li><a class="tocitem" href="../NEWS/">Release notes</a></li></ul></li><li><span class="tocitem">How to</span><ul><li><a class="tocitem" href="../../how-to/adapt-emx-elem/">Adapt an EMX element</a></li><li><a class="tocitem" href="../../how-to/use-emrh/">Use the package</a></li></ul></li><li><span class="tocitem">Developer notes</span><ul><li><a class="tocitem" href="../../dev-notes/code-structure/">Code structure</a></li><li><a class="tocitem" href="../../dev-notes/initialization/">Problem initialization</a></li><li><a class="tocitem" href="../../dev-notes/future_value/">Future value implementation</a></li></ul></li><li><span class="tocitem">Library</span><ul><li><a class="tocitem" href="../../library/public/">Public</a></li><li><input class="collapse-toggle" id="menuitem-5-2" type="checkbox"/><label class="tocitem" for="menuitem-5-2"><span class="docs-label">Internals</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../library/internals/types-EMRH/">Types</a></li><li><a class="tocitem" href="../../library/internals/methods-EMRH/">Methods - Internal</a></li><li><a class="tocitem" href="../../library/internals/methods-EMB/">Methods - <code>EnergyModelsBase</code></a></li><li><a class="tocitem" href="../../library/internals/reset/">Resetting functionality</a></li><li><a class="tocitem" href="../../library/internals/reference-EMGExt/">Internals - EnergyModelsGeography extension</a></li><li><a class="tocitem" href="../../library/internals/reference-POIExt/">Internals - ParametricOptInterface extension</a></li></ul></li></ul></li><li><a class="tocitem" href="../../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>Future value</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Future value</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/EnergyModelsX/EnergyModelsRecedingHorizon.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/EnergyModelsX/EnergyModelsRecedingHorizon.jl/blob/main/docs/src/manual/future_value.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="man-fv"><a class="docs-heading-anchor" href="#man-fv">Implementation of future values</a><a id="man-fv-1"></a><a class="docs-heading-anchor-permalink" href="#man-fv" title="Permalink"></a></h1><p>A new <a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/case_element/#EnergyModelsBase.AbstractElement"><code>AbstractElement</code></a>, <a href="../../library/public/#EnergyModelsRecedingHorizon.FutureValue"><code>FutureValue</code></a>, has been implemented to be able to include additional terms to the objective without adding new nodes to the model. Within <code>EnergyModelsRecedingHorizon</code>, we implemented two composite subtypes:</p><ol><li>The composite type <a href="../../library/public/#EnergyModelsRecedingHorizon.StorageValueCuts"><code>StorageValueCuts</code></a> can be used to describe the value of storages at the end of the optimization period as multiple cutting hyperplanes that depend on one or several of the outgoing state variables. Its implementation is explained below in <em><a href="#man-fv-sev">Storage end values</a></em>. For more details about the generation of cuts in stochastic dual dynamic programming we refer to [<a href="../../references/#Dowson2020">3</a>].</li><li>The composite type <a href="../../library/public/#EnergyModelsRecedingHorizon.TypeFutureValue"><code>TypeFutureValue</code></a> adds a value to a given variable for all instances of a specified node. It is hence a simplified approach for elements which do not impact each other, <em>e.g.</em>, the state of a process. Its implementation is explained below in <em><a href="#man-fv-tev">Type end values</a></em>.</li></ol><h2 id="man-fv-sev"><a class="docs-heading-anchor" href="#man-fv-sev">Storage end values</a><a id="man-fv-sev-1"></a><a class="docs-heading-anchor-permalink" href="#man-fv-sev" title="Permalink"></a></h2><h3 id="man-fv-sev-fields"><a class="docs-heading-anchor" href="#man-fv-sev-fields">Introduced type and its fields</a><a id="man-fv-sev-fields-1"></a><a class="docs-heading-anchor-permalink" href="#man-fv-sev-fields" title="Permalink"></a></h3><p>A <a href="../../library/public/#EnergyModelsRecedingHorizon.StorageValueCuts"><code>StorageValueCuts</code></a> object includes a <code>weight</code>, a <code>time</code> and a <code>Vector{StorageValueCut}</code>. The <code>weight</code> indicates the factor of the respective <code>StorageValueCuts</code> in the objective function. Cuts are often combined with discrete Markov states such that the resulting storage end value is a weighted sum of several different <code>StorageValueCuts</code>. The <code>time</code> indicates at which time the <code>StorageValueCuts</code> are valid relative to the start time of the optimization problem in a given receding horizon iteration.</p><p>Each <a href="../../library/public/#EnergyModelsRecedingHorizon.StorageValueCut"><code>StorageValueCut</code></a> object is defined by a set of coefficients <code>coeffs</code>, and a constant <code>rhs</code>. The <code>coeffs</code> can be defined by a dictionary with keys <span>$s$</span> and values <span>$w_s$</span>, where <span>$s$</span> denotes a given <a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/nodes/storage/#nodes-storage"><code>Storage</code></a> node for which the cut refers to, and <span>$w_s$</span> denotes the coefficient for the given cut.</p><h3 id="man-fv-sev-math"><a class="docs-heading-anchor" href="#man-fv-sev-math">Mathematical description</a><a id="man-fv-sev-math-1"></a><a class="docs-heading-anchor-permalink" href="#man-fv-sev-math" title="Permalink"></a></h3><p>Let <span>$\texttt{future\_value}$</span> denote the future value of storages in a system given by <code>StorageValueCuts</code>. Multiple <a href="../../library/public/#EnergyModelsRecedingHorizon.StorageValueCut"><code>StorageValueCut</code></a> elements bound the value of <span>$\texttt{future\_value}$</span> with linear cutting hyperplanes:</p><p class="math-container">\[\begin{aligned}
    \texttt{future\_value}[v] + \sum_{s, w_s} w_s \times \texttt{stor\_level}[s,t_{end}] \leq cut\_rhs(c) \qquad \forall c \in C_v, v \in V
\end{aligned}\]</p><p>where <span>$v ∈ V$</span> denotes the set of all active <code>StorageValueCuts</code> for a given model, <span>$C_v$</span> the set of cuts in <span>$v$</span>, <span>$c$</span> represents each <code>StorageValueCut</code> in <span>$v$</span>, and <span>$(s, w_s)$</span> represents the set of coefficients for <span>$c$</span> in the <code>coeffs</code> field.</p><p>The following terms are added to objective:</p><p class="math-container">\[\begin{aligned}
    \sum_{v \in V} weight(v) \times time\_weight(v) \times \texttt{future\_value}[v]
\end{aligned}\]</p><p>The term <span>$weight(v)$</span> refers to a constant weight defined for the <a href="../../library/public/#EnergyModelsRecedingHorizon.StorageValueCuts"><code>StorageValueCuts</code></a> element (field <code>weight</code>). The term <span>$time\_weight(v)$</span> is updated for every <a href="../../library/public/#EnergyModelsRecedingHorizon.StorageValueCuts"><code>StorageValueCuts</code></a> element along the receding horizon iterations. The only non-zero weights will be related to <a href="../../library/public/#EnergyModelsRecedingHorizon.StorageValueCuts"><code>StorageValueCuts</code></a> closest in time to the current optimization end time.</p><p>For example, consider a receding horizon iteration for which the optimization problem ends at 168 time units after the full problem&#39;s first operational period. If there exists one or multiple <code>StorageValueCuts</code> objects where <code>time</code> is 168, we use these <code>StorageValueCuts</code> to valuate the storage at the end of the iteration. Otherwise, if the closest <code>StorageValueCuts</code> in both directions are defined at times 160 and 180, we will use a weighted sum of these to cuts as the end value. Currently, a <code>StorageValueCuts</code> must be added for <code>time</code> = 0.</p><p>Let <span>$t_{end}$</span> denote the end time of the optimization relative to the start time. Let <span>$t_{down}$</span> and <span>$t_{up}$</span> denote the time of the cut(s) nearest to <span>$t_{end}$</span> in either directions, and <span>$v_{down}$</span> and <span>$v_{up}$</span> the corresponding <code>StorageValueCuts</code>. The value of <span>$time\_weight(v)$</span> can be expressed as weighting between the cuts above and below <span>$t_{end}$</span>:</p><p class="math-container">\[\begin{aligned}
    time\_weight(v_{down}) = 1 - \frac{t_{end} - t_{down}}{t_{up} - t_{down}} \\
    time\_weight(v_{up}) = 1 - time\_weight(v_{down})
\end{aligned}\]</p><h2 id="man-fv-tev"><a class="docs-heading-anchor" href="#man-fv-tev">Type end values</a><a id="man-fv-tev-1"></a><a class="docs-heading-anchor-permalink" href="#man-fv-tev" title="Permalink"></a></h2><h3 id="man-fv-tev-fields"><a class="docs-heading-anchor" href="#man-fv-tev-fields">Introduced type and its fields</a><a id="man-fv-tev-fields-1"></a><a class="docs-heading-anchor-permalink" href="#man-fv-tev-fields" title="Permalink"></a></h3><p>The composite type <a href="../../library/public/#EnergyModelsRecedingHorizon.TypeFutureValue"><code>TypeFutureValue</code></a> can be used if you plan to use a single value for a variable for all instances of a node. In this case, the value is the same.</p><p>The fields of a <a href="../../library/public/#EnergyModelsRecedingHorizon.TypeFutureValue"><code>TypeFutureValue</code></a> are given as:</p><ul><li><strong><code>element_type::Type{&lt;:AbstractElement}</code></strong>:<br/>The node type corresponds to the type for which a variable is resulting in an additional contribution to the cost function. The contribution is added for <strong>all</strong> instances of a given type.</li><li><strong><code>val_dict::Dict{Symbol, Real}</code></strong>:<br/>The value dictionary is including the variables that should have a future value as keys and the corresponding future value as value. The value has a corresponding cost value, <em>e.g.</em>, €/1000 h when looking at the previous utilization of an electrolyser. A positive value corresponds to a beneficial contribution.<br/>It is also possible to provide a single variable and value through the implementation of a constructor.</li></ul><div class="admonition is-warning"><header class="admonition-header">Other AbstractElements</header><div class="admonition-body"><p>While the functionality is in theory able to be used for any other <code>AbstractElement</code>, we currently limit it explicitly to nodes to avoid potential method ambiguities in the function <code>constraints_couple</code>.</p></div></div><div class="admonition is-danger"><header class="admonition-header">Utilizing `TypeFutureValue`</header><div class="admonition-body"><p><code>TypeFutureValue</code> is introduced for a simplified approach for providing a cost contribution to all instances of a given element type. It should <strong>never</strong> be used for the reference nodes! Specifically, care has to be taken regarding the meaning of the provided value. If, <em>e.g.</em>, you provide a cost to the previous usage of an electrolyzer, the unit of the value should be given by €/1000 h and be negative.</p></div></div><h3 id="man-fv-tev-math"><a class="docs-heading-anchor" href="#man-fv-tev-math">Mathematical description</a><a id="man-fv-tev-math-1"></a><a class="docs-heading-anchor-permalink" href="#man-fv-tev-math" title="Permalink"></a></h3><p>Given the set of nodes corresponding to the type <code>element_type</code> is given <span>$N^{sub}$</span>, we can calculate the future value as:</p><p class="math-container">\[\texttt{future\_value}[v] = \sum_{(\texttt{var}, val) \in coefficients(v)} val \sum_{n \in N^{sub}} \texttt{var}(n, last(t))\]</p><div class="admonition is-info"><header class="admonition-header">The variable var</header><div class="admonition-body"><p>The variable <code>var</code> is corresponding to the specified variable name in the model. It <strong>must</strong> be indexed over the node and the operational period.</p></div></div></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../philosophy/">« Philosophy</a><a class="docs-footer-nextpage" href="../simple-example/">Example »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.10.2 on <span class="colophon-date" title="Tuesday 29 April 2025 06:53">Tuesday 29 April 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
